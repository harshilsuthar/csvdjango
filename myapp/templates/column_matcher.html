<style>
    .my-custom-scrollbar {
        position: relative;
        height: min-content;
        overflow: auto;
    }

    .table-wrapper-scroll-y {
        display: block;
    }

</style>
<div class="row" style="min-height: min-content;">
    <div class="col-12">
        <h3 style="color: #28C76F;">Match CSV with Table</h3>
    </div>
    <!-- <div class="col-12 d-flex justify-content-end m-2">
        <button id='id_checkcsv' class="btn btn-success mr-4" type="button">Validate</button>
        <button id='id_commit' class="btn btn-success" type="button">Commit</button>
    </div> -->
    <div class="table-wrapper-scroll-y my-custom-scrollbar col-12">
        <table class="table border" style="max-width: max-content;">
            <tr>
                {% for header in raw_header %}
                <td style="width: fit-content;">
                    <select class="csv_header form-control" style="width: 150px;" name="header{{ forloop.counter}}" id="id_header{{ forloop.counter}}">
                        <option value="None">Select Header</option>
                        {% for option in raw_header %}
                        <option value="{{option}}">{{option}}</option>
                        {% endfor %}
                    </select>
                </td>
                {% endfor %}
            </tr>
            <tr>
                {% for header in raw_header %}
                <td style="width: fit-content;">
                    <select class="table_field form-control" style="width: 150px;" name="field{{ forloop.counter}}" id="id_field{{ forloop.counter}}">
                        <option value="None">Select Field</option>
                        {% for option in table_columns_list %}
                        <option value="{{option}}">{{option}}</option>
                        {% endfor %}
                    </select>
                </td>
                {% endfor %}
            </tr>
        </table>
    </div>
</div>
<script>
    $(window).ready(function () {
        $('.csv_header').change(function () {
            reEvaluateAvailableOptions($('.csv_header'));
        });
        $('.table_field').change(function () {
            reEvaluateAvailableOptions($('.table_field'));
        });

        function reEvaluateAvailableOptions(select_dropdown) {
            var selectedValues = [];
            select_dropdown.each(function () {
                var value = $(this).val();
                if(value != 'None'){
                    selectedValues.push(value);
                }
                
            });
            console.log(selectedValues)

            // Disable all the selected values.
            select_dropdown.each(function () {
                var currentValue = $(this).val();
                $(this).children('option')
                    .prop("hidden",false)
                    .each(function () {

                        var value = this.value;
                        if (selectedValues.indexOf(value) >=0 && currentValue != value) {
                            $(this).prop('hidden', true);
                        }
                    });
            });
        }
        $('#id_checkcsv').prop('hidden',false)
        $('#id_commit').prop('hidden',false)
    })
</script>

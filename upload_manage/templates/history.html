{% extends 'base.html' %}
{% block headscript %}
<style>
    .my-custom-scrollbar {
        position: relative;
        height: 450px;
        overflow: auto;
    }

    .table-wrapper-scroll-y {
        display: block;
    }

</style>
{% endblock headscript %}
{% block body %}

{% if history_data %}
<div class="table-wrapper-scroll-y my-custom-scrollbar">
    <table class="table mb-0" style="height: min-content; max-width: max-content; width: max-content;">
        <thead>
            <tr>
                <th>server</th>
                <th>server user</th>
                <th>server host</th>
                <th>server port</th>
                <th>database</th>
                <th>table</th>
                <th>uploaded file</th>
                <th>process state</th>
                <th>message</th>
                <th>error file</th>
                <th>commited</th>
                <th>upload time</th>
                <th>finish time</th>
                <th>Action</th>
            </tr>
        </thead>
        {% for data in history_data %}
        <tbody>
            <tr>
                <td>{{data.server_name}}</td>
                <td>{{data.server_username}}</td>
                <td>{{ data.server_host}}</td>
                <td>{{ data.server_port}}</td>
                <td>{{ data.server_database}}</td>
                <td>{{ data.server_table}}</td>
                <td><a href="/media/{{data.uploaded_file}}" class="d-flex justify-content-center"><i class="fa fa-download fa-2x"></i></a></td>
                <td>{{ data.process_state}}</td>
                
                {% if data.error_file == '' and data.process_state == 'error'%}
                <td>{{ data.message }}</td>
                <td>
                    <h6 style="color: red;">File Not Found</h6>
                </td>
                
                {% elif data.error_file == '' and data.process_state == 'completed'%}
                <td>None</td>
                <td>
                    <h6 style="color: green;">No Error Found</h6>
                </td>
                {% elif data.error_file != '' and data.process_state == 'completed'%}
                <td>{{ data.message }}</td>
                <td>
                    <a href="/media/{{data.error_file}}" class="d-flex justify-content-center"><i class="fa fa-download fa-2x"></i></a>
                </td>
                {% else %}
                <td>None</td>
                <td><a href="/media/{{data.error_file}}" class="d-flex justify-content-center"><i class="fa fa-download fa-2x"></i></a></td>
                {% endif %}
                <td>{{data.commited}}</td>
                <td>{{ data.upload_time}}</td>
                <td>{{ data.finish_time}}</td>
                <td>
                    <center><a href="{% url 'upload_manage:DeleteHistory' data.id %}"><i
                               class="fa fa-trash text-danger fa-2x" aria-hidden="true"></i></a></center>
                </td>
            </tr>
        </tbody>
        {% endfor %}
    </table>
</div>
{% else %}
<h6 class="alert alert-warning row mt-5 w-75 align-items-center justify-content-center">No History</h6>
{% endif %}

{% endblock body%}


{% block endscript %}
<script>
    $(document).ready(function () {
        $('th').each(function () {
            $(this).css('text-transform', 'capitalize')
        })
    })
</script>
{% endblock endscript %}
